# Findec Vaults
DeFi vaults beta version

## Overview

Findec v0 vaults are smart contracts design to manage a hedged lp position. In our v0 vaults, shorting is performed using lending and borrowing protocols.
The key difference with other hedged lp vaults in DeFi. Is that findec v0 vaults allows the user to have directional exposure to price action. 

In simple terms, the strategy does the following: 
- Lend a stable token
- Borrow a variable token
- Provide liquidity to a uniswapV2 AMM

**Review Dynamic Hedging jupyter notebook for an in-depth review of the strategy.**

## Framework

We use Apeworkx and vyper as the framework and smart contract language
- [Ape](https://github.com/ApeWorX/ape)
- [Vyper](https://docs.vyperlang.org/en/stable/)

## Repo Structure

Besides apeworkx functionality, repo contains 2 other folders.
- cli: python click app to interact either as user strategist or owner with smart contracts
- analysis: scripts containing detailed analysis and explanations of dynamic hedging strategy

## Smart Contracts Design

There are 3 smart contracts that handle all logic related to a specific strategy. 2 of them are ERC4626 compliant vault contracts, and the other one is the 
strategy contract. Vaults contain the accounting logic while the strategy contract contains the lp hedging logic.

Users interact with the vault contracts. Only approved addresses (strategists, keepers and owner) can interact with the strategy contract. 
Each vault has an underlying asset, which is one of the assets used by the startegy contract. 

There are 2 types of vaults:
- Dynamic hedging vaults: lp hedgeding (underlying is stable token)
- Lending vaults: single sided lending (underlying is variable token)

## Strategy contract

Contains logic defined in the jupyter notebook. Contract has access control so only specific addressess can execute functions. 
- Keepers
  - Rebalance collateral ratio
  - Rebalance exposure
  - Harvest
 - Strategist
  - same access as keepers
  - Update target collateral ratio
  - Update min and max collateral ratio
  - Update target exposure
  - Update exposure threshold
- Owner
  - Set strategists and keepers
  - Set max allowed collateral ratio (target, min and max collateral ratio can't be more than this value)
  - Set max short and long exposure (defines range for acceptable target exposure)
- Dynamic Hedging Vault
  - Withdraw
- Lending Vault
  - Deposit secondary
  - Withdraw secondary

Only vaults can withdraw from strategy contract.

## Vaults

Both vaults interact the same strategy smart contract.

**Dynamic Hedging vault**
- Accounting logic based on dynamic hedging strategy valuations (uses both stable and variable token)
- Users are charged a performance fee on all deposits and withdrawals (except when no current deposits exist)
- Performance fee is only charged if returns are positive during the investment time period
- A small deposit fee (0.1%) is charged during all deposits, this is divided between all users in the pool
- 10% of farming rewards are paid as fees
- 5% to single sided lending users
- 5% to owner

**Lending vault** 
- Account logic based on variable token (only looks at the amount lent of variable token by the strategy)
- Used to reduce liquidation risk
- Users get compensated from the extra risk with higher yield
- Users keep 5% of the lp farming rewards generated by dynamic hedging users

